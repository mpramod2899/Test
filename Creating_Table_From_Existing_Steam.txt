Here’s a sample query to create table out of our existing stream that holds value and volume per transaction accepted/rejected within 15 seconds window.

CREATE  TABLE T_15 AS SELECT
    SRC_JSON.TX_STATUS TX_STATUS,
    COUNT(*) VOLUME,
    SUM(SRC_JSON.TOTAL_INTBK_SETT_AMOUNT) VALUE
FROM SRC_JSON SRC_JSON
WINDOW TUMBLING ( SIZE 15 SECONDS )
GROUP BY SRC_JSON.TX_STATUS
EMIT CHANGES;


To check the data in the newly created table run (the SET statement prevents the query from emitting intermediate results)
SET 'commit.interval.ms’='30000’;

SELECT TIMESTAMPTOSTRING(WINDOWSTART, 'yyy-MM-dd HH:mm:ss') WINDOW_START,
  TIMESTAMPTOSTRING(WINDOWEND, 'yyy-MM-dd HH:mm:ss') WINDOW_END,
 TX_STATUS ,  VOLUME , VALUE  from T_15 EMIT CHANGES;


You can also run queries against time ranges e.g.

SELECT  TX_STATUS, TIMESTAMPTOSTRING(WINDOWSTART,'yyyy-MM-dd''T''HH:mm:ss') START_WINDOW, VOLUME, VALUE  from T_15 WHERE WINDOWSTART >= '2021-08-05T15:57:00' AND  WINDOWSTART < '2021-08-05T16:57:00' and TX_STATUS='ACTC’;


Reference :
https://docs.confluent.io/platform/current/ksqldb/tutorials/basics-local.html


Update the RoleBinding for ksql User to create a topic . For ex above Query by default create the topic with same name as Table (T_15) so we need to add rolebinding for it 

apiVersion: platform.confluent.io/v1beta1
kind: ConfluentRolebinding
metadata:
  name: ksql-1
  namespace: confluent
spec:
  principal:
    name: ksql
    type: user
  resourcePatterns:
 - name: T_                     
    patternType: PREFIXED
    resourceType: Topic
  role: ResourceOwner

